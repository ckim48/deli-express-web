<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Profile • Deli Express</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="../static/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <style>

  </style>
</head>
<body>

  <nav class="navbar navbar-light sticky-top">
    <div class="container">
      <a class="navbar-brand link-brand" href="home.html">
        <img src="../static/images/logo_nav.png" alt="Deli Express">
      </a>
      <button class="navbar-toggler" type="button"
              data-bs-toggle="offcanvas" data-bs-target="#mainNav"
              aria-controls="mainNav" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
    </div>
  </nav>

  <div class="offcanvas offcanvas-end" tabindex="-1" id="mainNav" aria-labelledby="mainNavLabel"
       data-bs-scroll="true" data-bs-backdrop="true">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="mainNavLabel">Deli Express</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="home.html">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="menu.html">Menu</a></li>
        <li class="nav-item"><a class="nav-link" href="orders.html">Orders</a></li>
        <li class="nav-item"><a class="nav-link active" href="profile.html">Profile</a></li>
      </ul>
    </div>
  </div>

  <div class="main-content">
    <div class="container page-wrap">

      <!-- Stats -->
      <div class="row g-3 g-md-4 mb-4">
        <!-- Total Orders Today -->
        <div class="col-6 col-md-3">
          <div class="stat-card p-3 h-100">
            <div class="d-flex align-items-center justify-content-between mb-2">
              <span class="stat-title">Orders Today</span>
              <i class="bi bi-bag-check" style="color:var(--c-539)"></i>
            </div>
            <div class="stat-value" id="ordersToday">—</div>
            <div class="stat-sub">as of now</div>
          </div>
        </div>

        <!-- Total Expenses Today -->
        <div class="col-6 col-md-3">
          <div class="stat-card p-3 h-100">
            <div class="d-flex align-items-center justify-content-between mb-2">
              <span class="stat-title">Expenses Today</span>
              <i class="bi bi-cash-coin" style="color:var(--c-539)"></i>
            </div>
            <div class="stat-value" id="expensesToday">$—</div>
            <div class="stat-sub">USD</div>
          </div>
        </div>

        <!-- My Express Pass -->
        <div class="col-12 col-md-3">
          <div class="stat-card p-3 h-100 d-flex flex-column">
            <div class="d-flex align-items-center justify-content-between mb-2">
              <span class="stat-title">My Express Pass</span>
              <i class="bi bi-lightning-charge-fill" style="color:var(--c-539)"></i>
            </div>
            <div class="stat-value" id="expressStatus">Inactive</div>
            <div class="stat-sub mb-2" id="expressSubtext">Get faster pickup in Express queue.</div>
            <div class="mt-auto">
              <a href="/pass/express" class="btn btn-express w-100">Buy Express Pass</a>
            </div>
          </div>
        </div>

        <!-- My Points -->
        <div class="col-12 col-md-3">
          <div class="stat-card p-3 h-100">
            <div class="d-flex align-items-center justify-content-between mb-2">
              <span class="stat-title">My Points</span>
              <i class="bi bi-stars" style="color:var(--c-539)"></i>
            </div>
            <div class="stat-value" id="myPoints">—</div>
            <div class="stat-sub">Earn by surveys & orders</div>
          </div>
        </div>
      </div>

      <!-- Charts -->
      <div class="row g-3 g-md-4">
        <div class="col-12 col-lg-6">
          <div class="glass p-3 p-md-4 h-100">
            <div class="d-flex align-items-center justify-content-between mb-2">
              <h2 class="section-title h5 mb-0">Weekly Orders</h2>
              <span class="badge badge-brand rounded-pill text-dark">Last 5 days</span>
            </div>
            <div class="chart-wrap">
              <canvas id="weeklyChart" height="180"></canvas>
            </div>
          </div>
        </div>

        <!-- Monthly Overview (3 months, 2 bars each) -->
        <div class="col-12 col-lg-6">
          <div class="glass p-3 p-md-4 h-100">
            <div class="d-flex align-items-center justify-content-between mb-2">
              <h2 class="section-title h5 mb-0">Monthly Overview</h2>
              <span class="badge badge-brand rounded-pill text-dark">Recent 3 months</span>
            </div>
            <div class="chart-wrap">
              <canvas id="monthlyChart" height="180"></canvas>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <a href="/cart" class="fab fab-cart" data-bs-toggle="tooltip" data-bs-title="View Cart" aria-label="View Cart">
    <i class="bi bi-cart3"></i>
    <span class="badge rounded-pill text-bg-danger fab-badge" id="cartCount">0</span>
  </a>
  <a href="/order/start" class="btn fab fab-order" data-bs-toggle="tooltip" data-bs-title="Start Order" aria-label="Start Order">
    <i class="bi bi-lightning-charge-fill"></i>
  </a>
  <footer>
    © <span id="y"></span> Deli Express • Chadwick International School
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    // Mock data
    const profileData = {
      ordersToday: 3,
      expensesToday: 27.40,
      expressActive: false,
      points: 240,
      weeklyOrders: { labels: ['Mon','Tue','Wed','Thu','Fri'], counts: [2, 3, 1, 4, 2] },
      monthly: {
        labels: ['Jun','Jul','Aug'],
        orders: [16, 18, 12],
        expenses: [124.3, 138.7, 98.2]
      }
    };

    const fmtMoney = n => `$${n.toFixed(2)}`;
    document.getElementById('ordersToday').textContent = profileData.ordersToday;
    document.getElementById('expensesToday').textContent = fmtMoney(profileData.expensesToday);
    document.getElementById('myPoints').textContent = profileData.points;
    document.getElementById('expressStatus').textContent = profileData.expressActive ? 'Active' : 'Inactive';
    document.getElementById('expressSubtext').textContent =
      profileData.expressActive ? 'Express perks enabled.' : 'Get faster pickup in Express queue.';

    const cssVar = name => getComputedStyle(document.documentElement).getPropertyValue(name).trim();
    const c539 = cssVar('--c-539');
    const c542 = cssVar('--c-542');
    const c544 = cssVar('--c-544');
    const ink  = cssVar('--ink');

    Chart.defaults.font.family = getComputedStyle(document.body).fontFamily;
    Chart.defaults.color = ink;

    const weeklyCtx = document.getElementById('weeklyChart').getContext('2d');
    new Chart(weeklyCtx, {
      type: 'bar',
      data: {
        labels: profileData.weeklyOrders.labels,
        datasets: [{
          label: 'Orders',
          data: profileData.weeklyOrders.counts,
          borderRadius: 8,
          backgroundColor: c542,
          borderColor: c542
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true, ticks: { stepSize: 1 }, grid: { color: 'rgba(0,0,0,.06)' } },
          x: { grid: { display: false } }
        },
        plugins: {
          legend: { display: false },
          tooltip: { callbacks: { label: ctx => ` ${ctx.parsed.y} orders` } }
        }
      }
    });

    const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
    new Chart(monthlyCtx, {
      type: 'bar',
      data: {
        labels: profileData.monthly.labels,
        datasets: [
          {
            label: 'Total Orders',
            data: profileData.monthly.orders,
            borderRadius: 8,
            backgroundColor: c542,
            borderColor: c542,
            order: 1
          },
          {
            label: 'Total Expenses ($)',
            data: profileData.monthly.expenses,
            borderRadius: 8,
            backgroundColor: c544,
            borderColor: c544,
            order: 2,
            yAxisID: 'y1'
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true, position: 'left', grid: { color: 'rgba(0,0,0,.06)' }, title: { display:true, text:'Orders' } },
          y1: { beginAtZero: true, position: 'right', grid: { drawOnChartArea:false }, title: { display:true, text:'$' } },
          x: { grid: { display:false } }
        },
        plugins: {
          legend: { labels: { color: ink } },
          tooltip: {
            callbacks: {
              label: (ctx) => ctx.dataset.label.includes('Expenses')
                ? ` $${ctx.parsed.y.toFixed(2)}`
                : ` ${ctx.parsed.y} orders`
            }
          }
        }
      }
    });
  </script>
</body>
</html>
